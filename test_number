
Mastercard



5123450000000008
2223000000000007
5111111111111118
2223000000000023




//https://malkey.go.digitable.io/paysafe/?currency=LKR&price=100&email=abc@gmail.com&reference=123LKRTX

//https://malkey.go.digitable.io/paysafe/?currency=USD&price=10&email=abc@gmail.com&reference=123USDTX


url http://cmbgateway.loc/paysafe?currency=LKR&amount=2950&orderId=n1lPmnjkjnbnb8rfqae&description=test

 http://cmbgateway.loc/paysafe?currency=USD&amount=2950&orderId=n1bvcdre123y3ew&description=test



https://malkey.go.digitable.io/paysafe/cmb?currency=LKR&amount=50&orderId=SWED123&description=test




<img ?php echo ASSET_PATH_URL; ?>assets/combank.png" alt="Bank Icon" style="width: 24px; height: 24px; vertical-align: middle;">






<?php
require_once "ntb_sessionAuth.php";
require_once "config/config.php";
//require_once "config/config.sample.php";

try {
    $ntbToken = new ntbToken(APP_LIVE);
    $ntbToken->setOrderDetails([
        'amount' => isset($_GET['amount']) ? $_GET['amount'] : 1.00,
        'description' => isset($_GET['description']) ? $_GET['description'] : 'N/A',
        'orderId' => isset($_GET['orderId']) ? $_GET['orderId'] : '',
        'currency' => isset($_GET['currency']) ? $_GET['currency'] : 'USD'

    ]);

    $sessionId = $ntbToken->getSessionId();
}
catch (Exception $e) {
    echo json_encode(['error' => $e->getMessage()]);
    exit;
}
?>









<?php
require_once 'config/config.php';
//require_once 'config/config.sample.php';
require 'vendor/autoload.php';

class ntbToken {
    private $amount = 0;
    private $orderId = '';
    private $description = 'N/A';
    private $currency = 'USD';

    public function setOrderDetails(array $details){
        $this->amount = $details['amount'];
        $this->currency = $details['currency'];
        $this->description = $details['description'];
        $_SESSION['orderId'] = $this->orderId = $details['orderId'] == '' ? 'ORDR' . time() : $details['orderId'];
    
    }

    public function getOrderId() {
        return $this->orderId;
    }
    public function getAmount() {
        return $this->amount;
    }
    public function getDescreption() {
        return $this->description;
    }
    public function getCurrency() {
        return $this->currency;
    }

    public function getSessionId() {
        $sessionId = null;
        
        $url = 'https://nationstrustbankplc.gateway.mastercard.com/api/rest/version/81/merchant/'.MERCHANT_ID.'/session';

        $data = [
            "apiOperation" => "INITIATE_CHECKOUT",
            "checkoutMode" => "WEBSITE",
            "interaction" => [
                "operation" => "AUTHORIZE",
                "merchant" => [
                    "name" => NAME,
                    "logo" => LOGO,
                    "url" => "https://www.malkey.lk",
                    "phone" => "+94-112365365",
                    "email" => "info@malkey.lk"
                ],
                "returnUrl" => RETURN_URL,
                "locale" => "en_US",
                "style" => [
                    "theme" => "default"
                ]
            ],
            "order" => [
                "currency" => $this->currency,
                "amount" => $this->amount,
                "id" => $this->orderId,
                "description" => $this->description
            ]
        ];

        $options = [
            CURLOPT_URL => $url,
            CURLOPT_RETURNTRANSFER => true,
            CURLOPT_POST => true,
            CURLOPT_POSTFIELDS => json_encode($data),
            CURLOPT_HTTPHEADER => [
                "Content-Type: text/plain",
                "Authorization: Basic " . base64_encode(API_USERNAME . ":" . API_PASSWORD)
            ],
            CURLOPT_SSL_VERIFYPEER => false,
            CURLOPT_FAILONERROR => true
        ];

        $ch = curl_init();
        curl_setopt_array($ch, $options);
        $response = curl_exec($ch);

        if ($response === false) {
            $error_msg = curl_error($ch);
            $error_msg = curl_strerror(curl_errno($ch));
            error_log($error_msg);
            curl_close($ch);
            throw new Exception('cURL error: : ' . $error_msg, 8);
        }
        curl_close($ch);

        $result = json_decode($response, true);

        if (isset($result['session']['id'])) {
            return $result['session']['id'];
        } else {
            throw new Exception('Failed to create session: ' . json_encode($result), 9);
        }
    }
}